app.controller("loginCtrl",["$scope","$rootScope",function($scope,$rootScope){$("#incorrectPassword").hide(),$("#incorrectEmail").hide(),$("#noEmail").hide(),$("#gsIncorrectPassword").hide(),$("#balIncorrectPassword").hide(),$("#balIncorrectEmail").hide(),$("#gsIncorrectEmail").hide(),$("#signInIncorrectEmail").hide(),$("#signInIncorrectPassword").hide(),$("#UESignInIncorrectEmail").hide(),$("#UESignInIncorrectPassword").hide(),$("#signUpIncorrectEmail").hide(),$("#signUpIncorrectPassword").hide(),$scope.loginFormDOM=$("#loginForm"),$scope.signUpFormDOM=$("#signUpForm"),$scope.signInFormDOM=$("#signInForm"),$scope.GetStartedFormDOM=$("#GetStartedForm"),$scope.balsamiqLoginFormDOM=$("#balsamiqLoginForm"),$scope.forgotPasswordFormDOM=$("#forgotPasswordForm"),$scope.UESignInFormDOM=$("#UESignInForm"),$scope.getParameterByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.hash);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))};var hash=window.location.hash.split("/");hash[0].indexOf("?")>-1&&(hash=hash[0].split("?")),"#reset-password"==hash[0]&&($("#hdn-retrieve-emailid").val($scope.getParameterByName("recovery-email")),$("#hdn-pass-token").val($scope.getParameterByName("password-token"))),"#forgot-password"==hash[0]&&$scope.toggleForgotPasswordForm(),$scope.submitSignUp=function(){var $btn=this.signUpFormDOM.find("button");$scope.signUpForm.$invalid&&!$btn.hasClass("disabled")||(null!=$btn&&$btn.button("loading"),$btn.prop("disabled",!0),$btn.addClass("disabled"),$.ajax({url:"protected/actions/user.php?action=login-register",data:this.signUpFormDOM.serialize(),type:"POST",cache:!1,dataType:"html",success:function(data){var loginjson=eval("("+data+")");if("success"===loginjson.result&&loginjson.id>0){null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1);try{-1!==window.location.host.indexOf("canvasflip.com")&&ga("send",{hitType:"event",eventCategory:"Signed Up/Loged In",eventAction:"click",eventLabel:"Source - SignUpForm"})}catch(e){}localStorage.clear("ref-code"),localStorage.clear("ref-code-by"),loginjson.ref_code_applied?window.location.href="dashboard.php?ref_success=1"+$scope.pricingRedirect:window.location.href="dashboard.php"+$scope.pricingRedirect}else"Invalid Request"===loginjson.result&&1===loginjson.status?($("#signUpIncorrectEmail").show(),$btn.removeClass("disabled")):($("#signUpIncorrectPassword").show(),$btn.removeClass("disabled")),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)},error:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)},fail:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)}}))},$scope.submitLogin=function(){var $btn=this.loginFormDOM.find("button");$scope.loginForm.$invalid&&!$btn.hasClass("disabled")||(null!=$btn&&$btn.button("loading"),$btn.addClass("disabled"),$btn.prop("disabled",!0),$.ajax({url:"protected/actions/user.php?action=login-register",data:this.loginFormDOM.serialize(),type:"POST",cache:!1,dataType:"html",success:function(data){var loginjson=eval("("+data+")");if("success"===loginjson.result&&loginjson.id>0){null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1);try{-1!==window.location.host.indexOf("canvasflip.com")&&ga("send",{hitType:"event",eventCategory:"Signed Up/Loged In",eventAction:"click",eventLabel:"Source - FirstFold"})}catch(e){}localStorage.clear("ref-code"),localStorage.clear("ref-code-by"),loginjson.ref_code_applied?window.location.href="dashboard.php?ref_success=1":window.location.href="dashboard.php"}else"Invalid Request"===loginjson.result&&1===loginjson.status?($("#incorrectEmail").show(),$btn.removeClass("disabled")):($("#incorrectPassword").show(),$btn.removeClass("disabled")),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)},error:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)},fail:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)}}))},$scope.submitSignIn=function(){var $btn=this.signInFormDOM.find("button");$scope.signInForm.$invalid&&!$btn.hasClass("disabled")||(null!=$btn&&$btn.button("loading"),$btn.prop("disabled",!0),$btn.addClass("disabled"),$.ajax({url:"protected/actions/user.php?action=login-register",data:this.signInFormDOM.serialize(),type:"POST",cache:!1,dataType:"html",success:function(data){var loginjson=eval("("+data+")");if("success"===loginjson.result&&loginjson.id>0){null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1);try{-1!==window.location.host.indexOf("canvasflip.com")&&ga("send",{hitType:"event",eventCategory:"Signed Up/Loged In",eventAction:"click",eventLabel:"Source - LoginModal"})}catch(e){}localStorage.clear("ref-code"),localStorage.clear("ref-code-by"),loginjson.ref_code_applied?window.location.href="dashboard.php?ref_success=1":window.location.href="dashboard.php"}else"Invalid Request"===loginjson.result&&1===loginjson.status?($("#signInIncorrectEmail").show(),$btn.removeClass("disabled")):($("#signInIncorrectPassword").show(),$btn.removeClass("disabled")),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)},error:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("loading"),$btn.prop("disabled",!1)},fail:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)}}))},$scope.submitGetStarted=function(){var $btn=this.GetStartedFormDOM.find("button");$scope.GetStartedForm.$invalid&&!$btn.hasClass("disabled")||($btn.addClass("disabled"),null!=$btn&&$btn.button("loading"),$btn.prop("disabled",!0),$.ajax({url:"protected/actions/user.php?action=login-register",data:this.GetStartedFormDOM.serialize(),type:"POST",cache:!1,dataType:"html",success:function(data){var loginjson=eval("("+data+")");if("success"===loginjson.result&&loginjson.id>0){null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1);try{-1!==window.location.host.indexOf("canvasflip.com")&&ga("send",{hitType:"event",eventCategory:"Signed Up/Loged In",eventAction:"click",eventLabel:"Source - GetStarted"})}catch(e){}localStorage.clear("ref-code"),localStorage.clear("ref-code-by"),loginjson.ref_code_applied?window.location.href="dashboard.php?ref_success=1":window.location.href="dashboard.php"}else"Invalid Request"===loginjson.result&&1===loginjson.status?($("#gsIncorrectEmail").show(),$btn.removeClass("disabled")):($("#gsIncorrectPassword").show(),$btn.removeClass("disabled")),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)},error:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)},fail:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)}}))},$scope.submitBalsamiqLogin=function(){var $btn=this.balsamiqLoginFormDOM.find("button");$scope.balsamiqLoginForm.$invalid&&!$btn.hasClass("disabled")||($btn.addClass("disabled"),null!=$btn&&$btn.button("loading"),$btn.prop("disabled",!0),$.ajax({url:"protected/actions/user.php?action=login-register",data:this.balsamiqLoginFormDOM.serialize(),type:"POST",cache:!1,dataType:"html",success:function(data){var loginjson=eval("("+data+")");if("success"===loginjson.result&&loginjson.id>0){null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1),$rootScope.user.id=loginjson.id,$("body").append('<input id="userid" type="hidden" value="'+$rootScope.user.id+'">'),$scope.$apply(),$("#loginForBalsamiqModal").modal("hide"),$("#getProjects").trigger("click");try{-1!==window.location.host.indexOf("canvasflip.com")&&ga("send",{hitType:"event",eventCategory:"Signed Up/Loged In",eventAction:"click",eventLabel:"Source - Balsamiq"})}catch(e){}}else"Invalid Request"===loginjson.result&&1===loginjson.status?($("#balIncorrectEmail").show(),$btn.removeClass("disabled")):($("#balIncorrectPassword").show(),$btn.removeClass("disabled")),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)},error:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)},fail:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)}}))},$scope.forgotPassword=function(){var $btn=this.forgotPasswordFormDOM.find("button");$scope.forgotPasswordForm.$invalid&&!$btn.hasClass("disabled")||($btn.addClass("disabled"),null!=$btn&&$btn.button("loading"),$btn.prop("disabled",!0),$.ajax({url:"protected/actions/user.php?action=retrieve-password",data:this.forgotPasswordFormDOM.serialize(),type:"POST",cache:!1,dataType:"html",success:function(data){var loginjson=eval("("+data+")");"success"===loginjson.result?($btn.text("Check Your Email"),$btn.removeClass("disabled"),$("#forgotPasswordSuccessMsg").removeClass("hidden"),setTimeout(function(){$("#forgotPasswordSuccessMsg").addClass("hidden")},5e3)):"-1"==loginjson.status&&($("#noEmail").show(),$btn.removeClass("disabled")),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1);try{-1!==window.location.host.indexOf("canvasflip.com")&&ga("send",{hitType:"event",eventCategory:"Forgot Password",eventAction:"click",eventLabel:"Requested for new password"})}catch(e){}},error:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)},fail:function(e){$btn.removeClass("disabled"),null!=$btn&&$btn.button("reset"),$btn.prop("disabled",!1)}}))},$scope.submitUESignIn=function(){var e=this.UESignInFormDOM.find("button");$scope.UESignInForm.$invalid&&!e.hasClass("disabled")||(null!=e&&e.button("loading"),e.prop("disabled",!0),e.addClass("disabled"),$.ajax({url:"protected/actions/user.php?action=login-register",data:this.UESignInFormDOM.serialize(),type:"POST",cache:!1,dataType:"html",success:function(n){var o=JSON.parse(n);if("success"===o.result&&o.id>0){null!=e&&e.button("reset"),e.prop("disabled",!1);try{-1!==window.location.host.indexOf("canvasflip.com")&&ga("send",{hitType:"event",eventCategory:"Signed Up/Loged In",eventAction:"click",eventLabel:"Source - UserEngagement"})}catch(e){}localStorage.clear("ref-code"),localStorage.clear("ref-code-by"),o.ref_code_applied?window.location.href="dashboard.php?ref_success=1":window.location.href="dashboard.php"}else"Invalid Request"===o.result&&1===o.status?($("#UESignInIncorrectEmail").show(),e.removeClass("disabled")):($("#UESignInIncorrectPassword").show(),e.removeClass("disabled")),null!=e&&e.button("reset"),e.prop("disabled",!1)},error:function(n){e.removeClass("disabled"),null!=e&&e.button("reset"),e.prop("disabled",!1)},fail:function(n){e.removeClass("disabled"),null!=e&&e.button("reset"),e.prop("disabled",!1)}}))},$scope.hideError=function(){$("#incorrectPassword").hide(),$("#incorrectEmail").hide(),$("#noEmail").hide(),$("#gsIncorrectPassword").hide(),$("#gsIncorrectEmail").hide(),$("#signInIncorrectEmail").hide(),$("#signInIncorrectPassword").hide(),$("#signUpIncorrectEmail").hide(),$("#signUpIncorrectPassword").hide(),$("#balIncorrectPassword").hide(),$("#balIncorrectEmail").hide(),$("#UESignInIncorrectEmail").hide(),$("#UESignInIncorrectPassword").hide()}}]);
